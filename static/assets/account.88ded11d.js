import{h as A,G as D,r as q,L as $,$ as j,i as E,o as U,I as L,k as u,l as N,y as a,z as l,a6 as o,X as z,C as M,m as d,p as O,x as G,b as J,F as X}from"./vendor.14d7a511.js";import{s as C,_ as H,u as K,f as Q,S as f,b as W,c as Y}from"./index.1f7143d6.js";import{l as Z}from"./string.b6af3bf2.js";import{D as ee}from"./dragVerifyImgRotate.6a55b6bf.js";function se(){return C({url:"/system/user/getCaptcha",method:"get"})}function oe(h){return C({url:"/system/user/login",method:"post",data:h})}const te={class:"login-content-code"},ae=["src"],ne=A({setup(h){const{t:w}=D(),{proxy:V}=X(),_=q(null),I=K(),m=$(),F=j(),e=E({dialogVerifyVisible:!1,isPassingFour:!1,imgThree:"https://img1.baidu.com/it/u=2813520958,2218166536&fm=26&fmt=auto&gp=0.jpg",captchaImage:"",loginForm:{username:"admin",password:"123456",captcha:"",captchaId:""},rules:{username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"blur"}],captcha:[{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",trigger:"blur"}]},isShowPassword:!1,loading:{signIn:!1}});U(()=>{g()});const g=async()=>{let t=await se();e.captchaImage=t.base64Captcha,e.loginForm.captchaId=t.captchaId},b=L(()=>Q(new Date)),x=()=>{_.value.validate(t=>{if(t)B();else return!1})},B=async()=>{e.loading.signIn=!0;let t;try{t=await oe(e.loginForm)}catch{e.loading.signIn=!1,e.loginForm.captcha="",g();return}let s=t.data;f.set("token",s.token),f.set("menus",s.menus);let r=s.permissions;r.push("base");const i={username:s.user.username,userId:s.user.userId,roleId:s.user.roleId,deptId:s.user.deptId,postId:s.user.postId,photo:s.user.avatar||Z(s.user.username),time:new Date().getTime(),authBtnList:r,authPageList:r,lastLoginTime:new Date().getTime(),lastLoginIp:"127.0.0.1"};f.set("userInfo",i),await I.dispatch("userInfos/setUserInfos",i),I.state.themeConfig.themeConfig.isRequestRoutes?(await Y(),y()):(await W(),y())},P=()=>{e.dialogVerifyVisible=!0},v=()=>{e.dialogVerifyVisible=!1,console.log("\u901A\u8FC7\u6ED1\u5757\u9A8C\u8BC1"),e.isPassingFour=!1,x()},y=()=>{var s,r,i,c;let t=b.value;((s=m.query)==null?void 0:s.redirect)?F.push({path:(r=m.query)==null?void 0:r.redirect,query:Object.keys((i=m.query)==null?void 0:i.params).length>0?JSON.parse((c=m.query)==null?void 0:c.params):""}):F.push("/"),setTimeout(()=>{e.loading.signIn=!0;const p=w("message.signInText");J.success(`${t}\uFF0C${p}`),V.mittBus.emit("onSignInClick")},300)};return(t,s)=>{const r=u("el-input"),i=u("el-form-item"),c=u("el-col"),p=u("el-row"),k=u("el-button"),S=u("el-form"),R=u("el-dialog");return M(),N(z,null,[a(S,{ref:(n,T)=>{T.loginFormRef=n,_.value=n},model:o(e).loginForm,rules:o(e).rules,class:"login-content-form"},{default:l(()=>[a(i,null,{default:l(()=>[a(r,{type:"text",placeholder:t.$t("message.account.accountPlaceholder1"),"prefix-icon":"el-icon-user",modelValue:o(e).loginForm.username,"onUpdate:modelValue":s[0]||(s[0]=n=>o(e).loginForm.username=n),clearable:"",autocomplete:"off"},null,8,["placeholder","modelValue"])]),_:1}),a(i,null,{default:l(()=>[a(r,{type:o(e).isShowPassword?"text":"password",placeholder:t.$t("message.account.accountPlaceholder2"),"prefix-icon":"el-icon-lock",modelValue:o(e).loginForm.password,"onUpdate:modelValue":s[2]||(s[2]=n=>o(e).loginForm.password=n),autocomplete:"off"},{suffix:l(()=>[d("i",{class:O(["iconfont el-input__icon login-content-password",o(e).isShowPassword?"icon-yincangmima":"icon-xianshimima"]),onClick:s[1]||(s[1]=n=>o(e).isShowPassword=!o(e).isShowPassword)},null,2)]),_:1},8,["type","placeholder","modelValue"])]),_:1}),a(i,null,{default:l(()=>[a(p,{gutter:15},{default:l(()=>[a(c,{span:16},{default:l(()=>[a(r,{type:"text",maxlength:"6",placeholder:t.$t("message.account.accountPlaceholder3"),"prefix-icon":"el-icon-position",modelValue:o(e).loginForm.captcha,"onUpdate:modelValue":s[3]||(s[3]=n=>o(e).loginForm.captcha=n),clearable:"",autocomplete:"off"},null,8,["placeholder","modelValue"])]),_:1}),a(c,{span:8},{default:l(()=>[d("div",te,[d("img",{class:"login-content-code-img",onClick:g,width:"130px",height:"40px",src:o(e).captchaImage,style:{cursor:"pointer"}},null,8,ae)])]),_:1})]),_:1})]),_:1}),a(i,null,{default:l(()=>[a(k,{type:"primary",class:"login-content-submit",round:"",onClick:P,loading:o(e).loading.signIn},{default:l(()=>[d("span",null,G(t.$t("message.account.accountBtnText")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"]),a(R,{modelValue:o(e).dialogVerifyVisible,"onUpdate:modelValue":s[5]||(s[5]=n=>o(e).dialogVerifyVisible=n),title:"\u65CB\u8F6C\u9A8C\u8BC1\u7801",width:"300px",center:""},{default:l(()=>[a(ee,{imgsrc:o(e).imgThree,isPassing:o(e).isPassingFour,"onUpdate:isPassing":s[4]||(s[4]=n=>o(e).isPassingFour=n),text:"\u8BF7\u6309\u4F4F\u6ED1\u5757\u62D6\u52A8",successText:"\u9A8C\u8BC1\u901A\u8FC7",handlerIcon:"el-icon-d-arrow-right",successIcon:"el-icon-circle-check",onPasscallback:v},null,8,["imgsrc","isPassing"])]),_:1},8,["modelValue"])],64)}}});var ce=H(ne,[["__scopeId","data-v-5a14c2dc"]]);export{ce as default};
